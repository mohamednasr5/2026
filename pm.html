<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± - Kids Area</title>
Â  Â Â 
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* --- Themes & Colors --- */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #ff4757;
Â  Â  Â  Â  Â  Â  --secondary: #2f3542;
Â  Â  Â  Â  Â  Â  --accent: #1e90ff;
Â  Â  Â  Â  Â  Â  --success: #2ed573;
Â  Â  Â  Â  Â  Â  --warning: #ffa502;
Â  Â  Â  Â  Â  Â  --danger: #ff4757;
Â  Â  Â  Â  Â  Â  --purple: #a55eea;
Â  Â  Â  Â  Â  Â  --bg-body: #e5ddd5;
Â  Â  Â  Â  Â  Â  --surface: #ffffff;
Â  Â  Â  Â  Â  Â  --chat-sent: #dcf8c6;
Â  Â  Â  Â  Â  Â  --chat-recv: #ffffff;
Â  Â  Â  Â  Â  Â  --blue-tick: #34B7F1;
Â  Â  Â  Â  Â  Â  --radius: 16px;
Â  Â  Â  Â  Â  Â  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- General Reset --- */
Â  Â  Â  Â  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
Â  Â  Â  Â  body { background-color: #f1f2f6; color: var(--secondary); min-height: 100vh; display: flex; flex-direction: column; font-size: 16px; overflow-x: hidden; padding-bottom: 100px; /* Space for footer */ }

Â  Â  Â  Â  /* --- Scrollbar --- */
Â  Â  Â  Â  ::-webkit-scrollbar { width: 6px; }
Â  Â  Â  Â  ::-webkit-scrollbar-track { background: transparent; }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }

Â  Â  Â  Â  /* --- Header --- */
Â  Â  Â  Â  header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .header-top { background: var(--secondary); color: white; font-size: 0.85rem; padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  .header-content { padding: 15px 20px; display: flex; align-items: center; gap: 20px; max-width: 1200px; margin: 0 auto; }
Â  Â  Â  Â  .logo-img { height: 50px; width: 50px; border-radius: 50%; border: 2px solid #eee; }
Â  Â  Â  Â  .header-text h1 { color: var(--primary); font-weight: 800; font-size: 1.4rem; }

Â  Â  Â  Â  /* --- Login --- */
Â  Â  Â  Â  #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #ff9ff3 0%, #feca57 100%); display: flex; justify-content: center; align-items: center; z-index: 9999; }
Â  Â  Â  Â  .login-card { background: rgba(255,255,255,0.95); padding: 3rem 2rem; border-radius: 24px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.15); }
Â  Â  Â  Â  .login-input { width: 100%; padding: 15px; background: #f7f9fc; border: 2px solid transparent; border-radius: 12px; font-size: 1.3rem; text-align: center; margin: 2rem 0; letter-spacing: 5px; font-weight: bold; }
Â  Â  Â  Â  .login-input:focus { background: white; border-color: var(--primary); }

Â  Â  Â  Â  /* --- Main Layout --- */
Â  Â  Â  Â  main { flex: 1; padding: 1.5rem 1rem; max-width: 1200px; margin: 0 auto; width: 100%; }
Â  Â  Â  Â  .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
Â  Â  Â  Â  @media (min-width: 992px) { .dashboard-grid { grid-template-columns: 380px 1fr; } }

Â  Â  Â  Â  /* --- Cards --- */
Â  Â  Â  Â  .card { background: var(--surface); border-radius: var(--radius); padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02); }
Â  Â  Â  Â  .form-control { width: 100%; padding: 12px; background: #f8f9fa; border: 1px solid #dfe4ea; border-radius: 10px; font-size: 1rem; margin-bottom: 1rem; }
Â  Â  Â  Â  .form-control:focus { border-color: var(--accent); background: white; }

Â  Â  Â  Â  /* --- Buttons --- */
Â  Â  Â  Â  .btn { padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.95rem; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: var(--transition); }
Â  Â  Â  Â  .btn:active { transform: scale(0.96); }
Â  Â  Â  Â  .btn-primary { background: var(--secondary); color: white; }
Â  Â  Â  Â  .btn-danger { background: var(--danger); color: white; }
Â  Â  Â  Â  .btn-warning { background: var(--warning); color: white; }
Â  Â  Â  Â  .btn-whatsapp { background: #25D366; color: white; }
Â  Â  Â  Â  .btn-product { background: var(--purple); color: white; }Â 
Â  Â  Â  Â  .btn-success { background: var(--success); color: white; }
Â  Â  Â  Â  .btn-outline { background: transparent; border: 2px solid #ddd; color: #666; }

Â  Â  Â  Â  /* --- Active Kid Card --- */
Â  Â  Â  Â  .kid-card { background: white; border-radius: 16px; padding: 1rem; margin-bottom: 1rem; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border-right: 5px solid transparent; position: relative; }
Â  Â  Â  Â  .kid-card.in-status { border-right-color: var(--success); }
Â  Â  Â  Â  .kid-card.paused-status { border-right-color: var(--warning); }
Â  Â  Â  Â  .kid-card.out-status { border-right-color: #ccc; opacity: 0.9; }
Â  Â  Â  Â  @media (min-width: 600px) { .kid-card { flex-direction: row; justify-content: space-between; align-items: center; } }

Â  Â  Â  Â  .kid-info h3 { margin-bottom: 5px; font-size: 1.1rem; color: var(--secondary); display: flex; align-items: center; gap: 5px; }
Â  Â  Â  Â  .kid-meta { display: flex; gap: 5px; flex-wrap: wrap; font-size: 0.85rem; color: #777; }
Â  Â  Â  Â  .timer-display { font-family: monospace; font-weight: bold; color: var(--primary); background: #fff0f1; padding: 2px 8px; border-radius: 4px; }
Â  Â  Â  Â  .products-mini-list { font-size: 0.8rem; color: var(--purple); margin-top: 5px; font-weight: bold; }

Â  Â  Â  Â  .controls { display: flex; gap: 5px; flex-wrap: wrap; justify-content: flex-end; }
Â  Â  Â  Â  .controls .btn { padding: 8px 12px; font-size: 0.85rem; }

Â  Â  Â  Â  /* --- Stats View Styles --- */
Â  Â  Â  Â  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
Â  Â  Â  Â  .stat-card { background: white; padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.2s; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Ø¬Ø¹Ù„ ÙƒØ±Øª Ø§Ù„Ø²ÙˆØ§Ø± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¶ØºØ· */
Â  Â  Â  Â  .stat-card.clickable { cursor: pointer; border: 2px solid transparent; }
Â  Â  Â  Â  .stat-card.clickable:hover { border-color: var(--accent); transform: translateY(-5px); }

Â  Â  Â  Â  .stat-value { font-size: 2.5rem; font-weight: 800; color: var(--secondary); margin: 10px 0; }
Â  Â  Â  Â  .stat-label { color: #888; font-size: 0.9rem; }
Â  Â  Â  Â  .stat-icon { font-size: 1.5rem; margin-bottom: 10px; color: var(--primary); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- History List Modal Items --- */
Â  Â  Â  Â  .history-item { background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 10px; cursor: pointer; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  .history-item:hover { background: #fff; border-color: var(--accent); box-shadow: 0 3px 10px rgba(0,0,0,0.05); }

Â  Â  Â  Â  /* --- WHATSAPP STYLE CHAT --- */
Â  Â  Â  Â  .chat-container {Â 
Â  Â  Â  Â  Â  Â  margin-top: 1rem; border-radius: 16px; overflow: hidden;Â 
Â  Â  Â  Â  Â  Â  background: #e5ddd5;Â 
Â  Â  Â  Â  Â  Â  background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; height: 350px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  .chat-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 5px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .message {Â 
Â  Â  Â  Â  Â  Â  max-width: 80%; padding: 8px 10px; border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.95rem; line-height: 1.4; position: relative;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 1px rgba(0,0,0,0.1);Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .message.recv { align-self: flex-start; background: var(--chat-recv); color: #000; border-top-left-radius: 0; }
Â  Â  Â  Â  .message.sent { align-self: flex-end; background: var(--chat-sent); color: #000; border-top-right-radius: 0; }

Â  Â  Â  Â  .message.recv::before { content: ""; position: absolute; top: 0; left: -8px; width: 0; height: 0; border-top: 8px solid var(--chat-recv); border-left: 8px solid transparent; }
Â  Â  Â  Â  .message.sent::before { content: ""; position: absolute; top: 0; right: -8px; width: 0; height: 0; border-top: 8px solid var(--chat-sent); border-right: 8px solid transparent; }

Â  Â  Â  Â  .msg-content { margin-bottom: 2px; }
Â  Â  Â  Â  .msg-meta { align-self: flex-end; display: flex; align-items: center; gap: 4px; font-size: 0.7rem; color: #999; margin-top: -2px; margin-left: 5px; }
Â  Â  Â  Â  .tick-icon { font-size: 0.75rem; }
Â  Â  Â  Â  .tick-read { color: var(--blue-tick) !important; }

Â  Â  Â  Â  .chat-input-area { padding: 10px; background: #f0f0f0; display: flex; gap: 10px; align-items: center; }
Â  Â  Â  Â  .chat-input-area input { flex: 1; padding: 10px 15px; border-radius: 20px; border: none; background: white; }

Â  Â  Â  Â  .reaction-badge { position: absolute; bottom: -8px; left: -5px; background: white; border-radius: 50%; padding: 2px; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.2); animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
Â  Â  Â  Â  @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

Â  Â  Â  Â  .badge-count { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; border: 2px solid white; }

Â  Â  Â  Â  /* --- Modals --- */
Â  Â  Â  Â  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
Â  Â  Â  Â  .modal-content { background: white; padding: 20px; border-radius: 16px; width: 95%; max-width: 450px; position: relative; max-height: 90vh; overflow-y: auto; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Receipt Styles --- */
Â  Â  Â  Â  .receipt-card {
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  border: 1px dashed #ccc;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  background-image: radial-gradient(circle at 0 0, transparent 0, transparent 0), radial-gradient(circle at 100% 0, transparent 0, transparent 0);
Â  Â  Â  Â  }
Â  Â  Â  Â  .receipt-header { text-align: center; border-bottom: 2px dashed #eee; padding-bottom: 15px; margin-bottom: 15px; }
Â  Â  Â  Â  .receipt-logo { width: 60px; height: 60px; border-radius: 50%; margin-bottom: 5px; }
Â  Â  Â  Â  .receipt-welcome { font-size: 0.9rem; color: #555; margin-bottom: 5px; }
Â  Â  Â  Â  .receipt-title { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
Â  Â  Â  Â  .receipt-details { margin-bottom: 15px; font-size: 0.95rem; }
Â  Â  Â  Â  .receipt-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px dotted #f0f0f0; padding-bottom: 2px; }
Â  Â  Â  Â  .receipt-row.total-row { border-top: 2px solid #333; border-bottom: none; padding-top: 10px; margin-top: 10px; font-weight: bold; font-size: 1.2rem; }
Â  Â  Â  Â  .receipt-footer { text-align: center; margin-top: 20px; font-size: 0.85rem; color: #777; border-top: 2px dashed #eee; padding-top: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Parent View Specifics --- */
Â  Â  Â  Â  .parent-header-card { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 20px; }
Â  Â  Â  Â  .big-timer-circle { width: 180px; height: 180px; border-radius: 50%; border: 6px solid var(--primary); display: flex; align-items: center; justify-content: center; margin: 20px auto; font-size: 2.5rem; font-weight: 800; color: var(--secondary); background: #fff; padding: 10px; text-align: center; line-height: 1.2; }
Â  Â  Â  Â  .paused-circle { border-color: var(--warning); color: #777; font-size: 1rem; }

Â  Â  Â  Â  /* --- Custom Footer --- */
Â  Â  Â  Â  .dev-footer {
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  border-top: 1px solid #eee;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dev-footer p { margin: 5px 0; }
Â  Â  Â  Â  .dev-footer a { color: var(--accent); text-decoration: none; font-weight: bold; }
Â  Â  Â  Â  .dev-footer i { margin-left: 5px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Products List in Modal */
Â  Â  Â  Â  .manage-prod-item {
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  Â  Â  padding: 8px; border-bottom: 1px solid #f0f0f0; font-size: 0.9rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .manage-prod-item:last-child { border-bottom: none; }
Â  Â  Â  Â  .btn-delete-prod {
Â  Â  Â  Â  Â  Â  background: #ffe0e0; color: #ff4757; border: none;
Â  Â  Â  Â  Â  Â  padding: 4px 8px; border-radius: 5px; cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Utils */
Â  Â  Â  Â  .hidden { display: none !important; }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="login-screen">
Â  Â  Â  Â  <div class="login-card">
Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/mohamednasr5/opera/main/01.png" style="width:80px; border-radius:50%; margin-bottom:15px;">
Â  Â  Â  Â  Â  Â  <h2>Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± ÙƒÙŠØ¯Ø²</h2>
Â  Â  Â  Â  Â  Â  <input type="password" id="login-pass" class="login-input" placeholder="****" onkeypress="handleEnter(event)">
Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%" onclick="checkLogin()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <header>
Â  Â  Â  Â  <div class="header-top">
Â  Â  Â  Â  Â  Â  <span id="header-datetime">...</span>
Â  Â  Â  Â  Â  Â  <button id="logout-btn" class="btn btn-outline hidden" style="padding:4px 10px; font-size:0.8rem; border:1px solid rgba(255,255,255,0.5); color:white;" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/mohamednasr5/opera/main/01.png" class="logo-img">
Â  Â  Â  Â  Â  Â  <div class="header-text">
Â  Â  Â  Â  Â  Â  Â  Â  <h1>Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± Ù„Ù„Ø£Ø·ÙØ§Ù„ ğŸª</h1>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main>
Â  Â  Â  Â  <div id="admin-view" class="hidden">
Â  Â  Â  Â  Â  Â  <div class="dashboard-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 style="color:var(--primary); margin-bottom:15px;">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="checkin-form">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="child-name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="parent-phone" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 01)" maxlength="11" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="child-snack" class="form-control">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ØºØ²Ù„ Ø¨Ù†Ø§Øª">ØºØ²Ù„ Ø¨Ù†Ø§Øª (Ù…Ø¬Ø§Ù†ÙŠ) ğŸ­</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ÙØ´Ø§Ø±">ÙØ´Ø§Ø± (Ù…Ø¬Ø§Ù†ÙŠ) ğŸ¿</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary" style="width:100%">ØªØ³Ø¬ÙŠÙ„</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="new-child-qr" class="hidden" style="text-align:center; margin-top:20px; border-top:1px dashed #ccc; padding-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color:var(--success)">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="qr-code" style="display:flex; justify-content:center; margin:15px 0;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:grid; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-whatsapp" id="wa-btn-new">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" onclick="closeQR()">Ø¥ØºÙ„Ø§Ù‚</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-control" style="background:white; display:flex; gap:10px; padding:8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-search" style="color:#ccc; margin-top:3px;"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="admin-search" placeholder="Ø¨Ø­Ø«..." style="border:none; width:100%; outline:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="kids-list-active"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="margin:20px 0 10px; color:#777;">Ø³Ø¬Ù„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ÙŠÙˆÙ…</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="kids-list-history"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="stats-view" class="hidden">
Â  Â  Â  Â  Â  Â  <h2 style="margin-bottom:20px; border-bottom:2px solid var(--primary); padding-bottom:10px; display:inline-block;">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="stats-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-icon"><i class="fas fa-coins"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="stat-total-income">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø§Ù„ÙƒÙ„)</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" style="color:var(--success);" id="stat-today-income">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card clickable" onclick="showDailyHistory()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-icon"><i class="fas fa-users"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="stat-total-kids">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙˆØ§Ø± (Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶)</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="stats-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-icon"><i class="fas fa-shopping-basket"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" style="color:var(--purple);" id="stat-products-income">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø§Ù„ÙƒÙ„)</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-icon"><i class="fas fa-stopwatch"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="stat-time-income">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Øª ÙÙ‚Ø·</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="parent-view" class="hidden">
Â  Â  Â  Â  Â  Â  <div class="parent-header-card">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="p-status-badge" style="background:var(--success); color:white; display:inline-block; padding:5px 15px; border-radius:20px; font-weight:bold; margin-bottom:10px;">Ù…ØªÙˆØ§Ø¬Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹</div>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="p-child-name" style="font-size:1.8rem;">Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="p-child-id" style="background:#eee; display:inline-block; padding:2px 10px; border-radius:10px; margin:5px 0;">#0000</div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="big-timer-circle" id="live-timer">00:00:00</div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:1.5rem; font-weight:bold; color:var(--primary); margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="live-cost">0</span> Ø¬.Ù…
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="p-products-list" style="margin-top:15px; padding:10px; background:#f9f9f9; border-radius:10px; color:var(--purple); font-size:0.95rem; line-height:1.6;"></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card" style="padding:0; overflow:hidden;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chat-container" style="margin:0; border:none; height:400px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background:#075e54; color:white; padding:10px 15px; font-weight:bold;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-headset"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙŠØ¯Ø² Ø¥ÙŠØ±ÙŠØ§
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="parent-chat-messages" class="chat-messages"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="chat-input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="parent-message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" onclick="sendParentMessage()" style="border-radius:50%; width:40px; height:40px; padding:0;"><i class="fas fa-paper-plane"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="session-ended-view" class="hidden" style="text-align:center; padding-top:50px;">
Â  Â  Â  Â  Â  Â  <i class="fas fa-check-circle" style="font-size:4rem; color:var(--success);"></i>
Â  Â  Â  Â  Â  Â  <h2 style="margin:20px 0;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h2>
Â  Â  Â  Â  Â  Â  <div style="font-size:3rem; font-weight:800; color:var(--secondary); margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="final-cost-display">0</span> Ø¬.Ù…
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p style="font-size:1.2rem; margin-bottom:10px;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± â¤ï¸</p>
Â  Â  Â  Â  Â  Â  <p style="font-size:1.1rem; color:var(--primary); font-weight:bold;">Ù…Ù† Ù‡Ù†Ø§ ØªØ¨Ø¯Ø£ Ø§Ù„Ø­ÙƒØ§ÙŠØ© âœ¨</p>
Â  Â  Â  Â  </div>

Â  Â  </main>

Â  Â  <div class="dev-footer">
Â  Â  Â  Â  <p>Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± Ø¨ÙƒÙ„ Ø­Ø¨ â¤ï¸</p>
Â  Â  Â  Â  <p><strong>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</strong></p>
Â  Â  Â  Â  <p><a href="tel:01279934735"><i class="fas fa-phone"></i> 01279934735</a></p>
Â  Â  Â  Â  <p><a href="https://www.facebook.com/en.mohamed.nasr" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></p>
Â  Â  </div>

Â  Â  <div id="admin-chat-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content" style="height:80vh; display:flex; flex-direction:column; padding:0; overflow:hidden;">
Â  Â  Â  Â  Â  Â  <div style="background:#075e54; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="chat-modal-title" style="font-weight:bold;">Ù…Ø­Ø§Ø¯Ø«Ø©</span>
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-times" onclick="closeAdminChat()" style="cursor:pointer;"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="chat-container" style="margin:0; border:none; flex:1; border-radius:0;">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="admin-chat-history" class="chat-messages"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chat-input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="admin-chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" onclick="sendAdminMessage()" style="border-radius:50%; width:40px; height:40px; padding:0;"><i class="fas fa-paper-plane"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="product-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <h3 style="color:var(--purple); margin-bottom:10px;">ğŸ›ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
Â  Â  Â  Â  Â  Â  <p id="prod-modal-title" style="margin-bottom:15px; font-weight:bold; color:#555;"></p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="current-prod-list" style="max-height:150px; overflow-y:auto; background:#f9f9f9; padding:5px; border-radius:8px; margin-bottom:15px; border:1px solid #eee;"></div>

Â  Â  Â  Â  Â  Â  <div style="border-top:1px dashed #ccc; padding-top:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-bottom:10px; font-size:0.9rem;">Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="prod-name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹ØµÙŠØ±ØŒ Ù…ÙŠØ§Ù‡..)">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="prod-price" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø±">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-product" style="flex:1;" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ£ÙƒÙŠØ¯</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" style="flex:1;" onclick="closeProductModal()">Ø¥ØºÙ„Ø§Ù‚</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="checkout-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content" style="padding:15px;">
Â  Â  Â  Â  Â  Â  <div class="receipt-card" id="receipt-print-area">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/mohamednasr5/opera/main/01.png" class="receipt-logo">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-welcome">Ù„Ù‚Ø¯ Ø§Ø³ØªÙ…ØªØ¹ Ø·ÙÙ„ÙƒÙ… Ø¨Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ù†Ø§</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-title">Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± Ù„Ù„Ø£Ø·ÙØ§Ù„</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem; color:#999; margin-top:5px;" id="bill-date-line"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="bill-child-name" style="font-weight:bold;">-</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="bill-duration">-</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="bill-products-container" style="margin: 10px 0; border-top:1px dotted #ccc; padding-top:5px;"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-row total-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="bill-total-amount" style="color:var(--primary);">-</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¨ Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ±</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ù†Ù†ØªØ¸Ø± Ø¹ÙˆØ¯ØªÙƒÙ… Ù„Ù†Ø§ â¤ï¸</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div style="display:flex; flex-direction:column; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-send-bill-wa" class="btn btn-whatsapp" style="width:100%">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-confirm-checkout" class="btn btn-danger" style="flex:1;" onclick="confirmCheckout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" style="flex:1;" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="history-list-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="color:var(--secondary);">Ø³Ø¬Ù„ Ø®Ø±ÙˆØ¬ Ø§Ù„ÙŠÙˆÙ… ğŸ“…</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-times" onclick="closeHistoryModal()" style="cursor:pointer; font-size:1.2rem;"></i>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="daily-history-container" style="max-height:400px; overflow-y:auto;">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="toast-container" style="position:fixed; bottom:20px; left:20px; z-index:3000;"></div>
Â  Â Â 
Â  Â  <audio id="msg-sound" src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_3f32527b79.mp3"></audio>
Â  Â  <audio id="hour-sound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0c7443c.mp3"></audio>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
Â  Â  Â  Â  import { getDatabase, ref, push, onValue, update, set, get, remove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDJ_dnEZP62J871KLAg88_quQdUt01004o",
Â  Â  Â  Â  Â  Â  authDomain: "operakides.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "operakides",
Â  Â  Â  Â  Â  Â  storageBucket: "operakides.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "1028823199618",
Â  Â  Â  Â  Â  Â  appId: "1:1028823199618:web:16062acdd68c32002a299b",
Â  Â  Â  Â  Â  Â  measurementId: "G-W46366S9Z2"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getDatabase(app);

Â  Â  Â  Â  // --- Variables ---
Â  Â  Â  Â  let currentChildId = null;Â 
Â  Â  Â  Â  let currentLink = "";
Â  Â  Â  Â  let adminTimer = null;
Â  Â  Â  Â  let parentTimer = null;
Â  Â  Â  Â  let activeChatId = null;
Â  Â  Â  Â  let productTargetId = null;
Â  Â  Â  Â  let lastMsgCounts = {};
Â  Â  Â  Â  let currentBillPhone = "";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Sounds ---
Â  Â  Â  Â  const playMsgSound = () => document.getElementById('msg-sound').play().catch(()=>{});
Â  Â  Â  Â  const playHourSound = () => document.getElementById('hour-sound').play().catch(()=>{});

Â  Â  Â  Â  // --- Auth ---
Â  Â  Â  Â  window.handleEnter = (e) => { if(e.key === 'Enter') checkLogin(); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.checkLogin = () => {
Â  Â  Â  Â  Â  Â  const pass = document.getElementById('login-pass').value;
Â  Â  Â  Â  Â  Â  if(pass === '0100') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('admin-view').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('logout-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  initAdmin();
Â  Â  Â  Â  Â  Â  } else if (pass === '521988') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stats-view').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('logout-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  initStats();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.logout = () => location.reload();

Â  Â  Â  Â  // --- Routing ---
Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  if(urlParams.get('mode') === 'parent' && urlParams.get('id')) {
Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('parent-view').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  initParent(urlParams.get('id'));
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Stats Logic ---
Â  Â  Â  Â  function initStats() {
Â  Â  Â  Â  Â  Â  onValue(ref(db, 'children'), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = snap.val() || {};
Â  Â  Â  Â  Â  Â  Â  Â  let totalIncome = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let todayIncome = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let totalKids = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let productIncome = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let timeIncome = 0;

Â  Â  Â  Â  Â  Â  Â  Â  const todayStr = new Date().toLocaleDateString('en-US');

Â  Â  Â  Â  Â  Â  Â  Â  Object.values(data).forEach(child => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.status === 'out' && child.totalCost) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cost = parseFloat(child.totalCost);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalIncome += cost;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.exitTime) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const exitDate = new Date(child.exitTime).toLocaleDateString('en-US');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(exitDate === todayStr) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  todayIncome += cost;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalKids++; // Count only today's kids for the daily view
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Calculate products logic only for today or total if needed (Current logic calculates total)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let pCost = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.products) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.values(child.products).forEach(p => pCost += p.price);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  productIncome += pCost;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeIncome += (cost - pCost);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stat-total-income').innerText = totalIncome + ' Ø¬.Ù…';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stat-today-income').innerText = todayIncome + ' Ø¬.Ù…';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stat-total-kids').innerText = totalKids; // This is now TODAY's checked out count
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stat-products-income').innerText = productIncome + ' Ø¬.Ù…';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('stat-time-income').innerText = timeIncome + ' Ø¬.Ù…';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- NEW: History List Logic ---
Â  Â  Â  Â  window.showDailyHistory = () => {
Â  Â  Â  Â  Â  Â  document.getElementById('history-list-modal').style.display = 'flex';
Â  Â  Â  Â  Â  Â  const container = document.getElementById('daily-history-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = '<div style="text-align:center; padding:20px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  get(ref(db, 'children')).then((snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = snap.val() || {};
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  const todayStr = new Date().toLocaleDateString('en-US');
Â  Â  Â  Â  Â  Â  Â  Â  let found = false;

Â  Â  Â  Â  Â  Â  Â  Â  Object.entries(data).forEach(([key, child]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.status === 'out' && child.exitTime) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const exitDate = new Date(child.exitTime).toLocaleDateString('en-US');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(exitDate === todayStr) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'history-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; font-size:1.1rem;">${child.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.85rem; color:#777;">${new Date(child.exitTime).toLocaleTimeString('ar-EG')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:left;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; color:var(--primary);">${child.totalCost} Ø¬.Ù…</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem; color:#999;">#${child.childId}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => viewBillFromHistory(key, child);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!found) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø·ÙØ§Ù„ ØºØ§Ø¯Ø±ÙˆØ§ Ø§Ù„ÙŠÙˆÙ… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  window.closeHistoryModal = () => document.getElementById('history-list-modal').style.display = 'none';

Â  Â  Â  Â  window.viewBillFromHistory = (key, child) => {
Â  Â  Â  Â  Â  Â  Â // Setup bill logic for view only
Â  Â  Â  Â  Â  Â  Â currentBillPhone = child.phone;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // Calculate time based on stored data (Total cost - Products)
Â  Â  Â  Â  Â  Â  Â // But we need the hours. We can approximate or use stored data if we had it.
Â  Â  Â  Â  Â  Â  Â // Reverse Calculation:
Â  Â  Â  Â  Â  Â  Â let pTotal = 0;
Â  Â  Â  Â  Â  Â  Â let productsHTML = '';
Â  Â  Â  Â  Â  Â  Â let waProductsText = "";
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â if(child.products) {
Â  Â  Â  Â  Â  Â  Â  Â  Â Object.values(child.products).forEach(p => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pTotal += p.price;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const priceTxt = p.price > 0 ? `${p.price} Ø¬.Ù…` : 'Ù…Ø¬Ø§Ù†Ø§Ù‹';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  productsHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${p.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${priceTxt}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waProductsText += `â–«ï¸ ${p.name}: ${priceTxt}%0a`;
Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â if(productsHTML === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â productsHTML = '<div style="text-align:center; color:#ccc; font-size:0.8rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â waProductsText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©%0a";
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const totalCost = parseFloat(child.totalCost);
Â  Â  Â  Â  Â  Â  Â const timeCost = totalCost - pTotal;
Â  Â  Â  Â  Â  Â  Â const hours = Math.round(timeCost / 50); // Approximate back to hours
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // Set Data
Â  Â  Â  Â  Â  Â  Â const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
Â  Â  Â  Â  Â  Â  Â const exitDateObj = new Date(child.exitTime);
Â  Â  Â  Â  Â  Â  Â const dayName = days[exitDateObj.getDay()];
Â  Â  Â  Â  Â  Â  Â const dateStr = exitDateObj.toLocaleDateString('ar-EG');
Â  Â  Â  Â  Â  Â  Â const fullDate = `${dayName}ØŒ ${dateStr}`;

Â  Â  Â  Â  Â  Â  Â document.getElementById('bill-child-name').innerText = child.name;
Â  Â  Â  Â  Â  Â  Â document.getElementById('bill-duration').innerText = `${hours} Ø³Ø§Ø¹Ø© (${timeCost} Ø¬.Ù…)`;
Â  Â  Â  Â  Â  Â  Â document.getElementById('bill-date-line').innerText = fullDate;
Â  Â  Â  Â  Â  Â  Â document.getElementById('bill-products-container').innerHTML = productsHTML;
Â  Â  Â  Â  Â  Â  Â document.getElementById('bill-total-amount').innerText = child.totalCost + ' Ø¬.Ù…';
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // Construct WhatsApp Message
Â  Â  Â  Â  Â  Â  Â const waMessage = `*ÙØ§ØªÙˆØ±Ø© Ù…Ù†Ø·Ù‚Ø© Ø£Ù„Ø¹Ø§Ø¨ Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ±* ğŸª%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `Ù„Ù‚Ø¯ Ø§Ø³ØªÙ…ØªØ¹ Ø·ÙÙ„ÙƒÙ… *${child.name}* Ø¨Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ù†Ø§ ğŸ˜%0a%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `â³ *Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:* ${hours} Ø³Ø§Ø¹Ø§Øª%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `ğŸ’° *Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª:* ${timeCost} Ø¬.Ù…%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `ğŸ“‹ *Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:*%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â waProductsText +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `ğŸ’µ *Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* *${child.totalCost} Ø¬.Ù…*%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `ğŸ“… *Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${fullDate}%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… Ù…Ù†Ø·Ù‚Ø© Ø£Ù„Ø¹Ø§Ø¨ Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± â¤ï¸%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `Ù†Ù†ØªØ¸Ø± Ø¹ÙˆØ¯ØªÙƒÙ… Ù„Ù†Ø§ âœ¨`;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // Setup Buttons
Â  Â  Â  Â  Â  Â  Â const btn = document.getElementById('btn-send-bill-wa');
Â  Â  Â  Â  Â  Â  Â btn.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â let p = currentBillPhone.replace(/[^0-9]/g,'');
Â  Â  Â  Â  Â  Â  Â  Â  Â if(p.startsWith('01')) p = '2' + p;
Â  Â  Â  Â  Â  Â  Â  Â  Â const url = `https://wa.me/${p}?text=${waMessage}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â window.open(url, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â // Hide Checkout Confirm button, Show Close only
Â  Â  Â  Â  Â  Â  Â document.getElementById('btn-confirm-checkout').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â document.getElementById('checkout-modal').style.display = 'flex';
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Admin Logic ---
Â  Â  Â  Â  function initAdmin() {
Â  Â  Â  Â  Â  Â  onValue(ref(db, 'children'), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = snap.val() || {};
Â  Â  Â  Â  Â  Â  Â  Â  const listActive = document.getElementById('kids-list-active');
Â  Â  Â  Â  Â  Â  Â  Â  const listHistory = document.getElementById('kids-list-history');
Â  Â  Â  Â  Â  Â  Â  Â  const search = document.getElementById('admin-search').value.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  listActive.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  listHistory.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  Object.entries(data).forEach(([key, child]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(search && !child.name.toLowerCase().includes(search) && !child.phone.includes(search)) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const products = child.products ? Object.values(child.products) : [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let prodText = products.map(p => `${p.name}`).join(' + ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(prodText) prodText = 'ğŸ›ï¸ ' + prodText;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.status === 'in' || child.status === 'paused') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let duration = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.status === 'in') duration = Date.now() - child.entryTime - (child.totalPausedTime||0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else duration = child.pauseStartTime - child.entryTime - (child.totalPausedTime||0);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hours = Math.floor(duration / 3600000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(child.lastHourAlert !== hours && hours > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playHourSound();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`â° Ø£ØªÙ… ${child.name} Ø³Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  update(ref(db, `children/${key}`), { lastHourAlert: hours });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const msgs = child.messages ? Object.values(child.messages) : [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const unreadCount = msgs.filter(m => m.sender === 'parent' && !m.read).length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(unreadCount > (lastMsgCounts[key] || 0)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playMsgSound();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`ğŸ“© Ø±Ø³Ø§Ù„Ø© Ù…Ù† ${child.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastMsgCounts[key] = unreadCount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const badge = unreadCount > 0 ? `<div class="badge-count">${unreadCount}</div>` : '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = `kid-card ${child.status === 'in' ? 'in-status' : 'paused-status'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="kid-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>${child.name} <span style="font-size:0.8rem; background:#eee; padding:2px 6px; border-radius:4px;">#${child.childId}</span></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="kid-meta">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ“± ${child.phone}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ½ï¸ ${child.snack}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="products-mini-list">${prodText}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="timer-display" style="margin-top:5px;">${formatTime(duration)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-product" onclick="openProductModal('${key}', '${child.name}')" title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"><i class="fas fa-cart-plus"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-whatsapp" onclick="openWhatsApp('${child.phone}', '${key}')"><i class="fab fa-whatsapp"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${child.status === 'in'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<button class="btn btn-warning" onclick="pause('${key}')"><i class="fas fa-pause"></i></button>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `<button class="btn btn-success" onclick="resume('${key}')"><i class="fas fa-play"></i></button>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="position:relative;" onclick="openAdminChat('${key}', '${child.name}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-comments"></i>${badge}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-danger" onclick="checkout('${key}')">Ø®Ø±ÙˆØ¬</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listActive.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (child.status === 'out') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'kid-card out-status';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="kid-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>${child.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="kid-meta">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ’° ${child.totalCost} Ø¬.Ù…</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ“… ${new Date(child.exitTime).toLocaleTimeString('ar-EG')}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="products-mini-list">${prodText}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listHistory.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if(adminTimer) clearInterval(adminTimer);
Â  Â  Â  Â  Â  Â  adminTimer = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  initAdmin();Â 
Â  Â  Â  Â  Â  Â  }, 1000);

Â  Â  Â  Â  Â  Â  document.getElementById('checkin-form').onsubmit = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  const name = document.getElementById('child-name').value;
Â  Â  Â  Â  Â  Â  Â  Â  const phone = document.getElementById('parent-phone').value;
Â  Â  Â  Â  Â  Â  Â  Â  const snack = document.getElementById('child-snack').value;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // --- Validation 1: Phone must be 11 digits and start with 01 ---
Â  Â  Â  Â  Â  Â  Â  Â  const phoneRegex = /^01[0-9]{9}$/;
Â  Â  Â  Â  Â  Â  Â  Â  if(!phoneRegex.test(phone)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† 11 Ø±Ù‚Ù… ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 01");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const cid = Math.floor(1000 + Math.random() * 9000);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const newRef = push(ref(db, 'children'));
Â  Â  Â  Â  Â  Â  Â  Â  const link = `${window.location.origin}${window.location.pathname}?mode=parent&id=${newRef.key}`;
Â  Â  Â  Â  Â  Â  Â  Â  currentLink = link;

Â  Â  Â  Â  Â  Â  Â  Â  set(newRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name, phone, snack, childId: cid,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entryTime: Date.now(), status: 'in',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  products: [], messages: [], totalPausedTime: 0, lastHourAlert: 0
Â  Â  Â  Â  Â  Â  Â  Â  }).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(snack) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  push(ref(db, `children/${newRef.key}/products`), {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: `${snack} (Ù…Ø¬Ø§Ù†ÙŠ)`,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: 0Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('checkin-form').reset();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('new-child-qr').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('qr-code').innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  new QRCode(document.getElementById('qr-code'), { text: link, width:100, height:100 });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('wa-btn-new').onclick = () => openWhatsApp(phone, newRef.key, link);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·ÙÙ„ ÙˆØ§Ø¶Ø§ÙØ© Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // --- ØªÙ… Ù†Ù‚Ù„ Ø³Ø·Ø± Ø§Ù„Ø¨Ø­Ø« Ø¥Ù„Ù‰ Ù‡Ù†Ø§ Ù„ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙˆÙÙˆØ±ÙŠ ---
Â  Â  Â  Â  Â  Â  document.getElementById('admin-search').addEventListener('input', initAdmin);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.openProductModal = (id, name) => {
Â  Â  Â  Â  Â  Â  productTargetId = id;
Â  Â  Â  Â  Â  Â  document.getElementById('prod-modal-title').innerText = name;
Â  Â  Â  Â  Â  Â  document.getElementById('product-modal').style.display = 'flex';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  onValue(ref(db, `children/${id}/products`), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const list = document.getElementById('current-prod-list');
Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  const data = snap.val();
Â  Â  Â  Â  Â  Â  Â  Â  if(data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.entries(data).forEach(([key, val]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'manage-prod-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${val.name} (${val.price} Ø¬.Ù…)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-delete-prod" onclick="deleteProduct('${id}', '${key}')">Ø­Ø°Ù ğŸ—‘ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '<div style="text-align:center; color:#999; font-size:0.8rem;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  window.deleteProduct = (childId, prodId) => {
Â  Â  Â  Â  Â  Â  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
Â  Â  Â  Â  Â  Â  Â  Â  remove(ref(db, `children/${childId}/products/${prodId}`));
Â  Â  Â  Â  Â  Â  Â  Â  showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.closeProductModal = () => {
Â  Â  Â  Â  Â  Â  document.getElementById('product-modal').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('prod-name').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('prod-price').value = '';
Â  Â  Â  Â  };

Â  Â  Â  Â  window.addProduct = () => {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('prod-name').value;
Â  Â  Â  Â  Â  Â  const price = document.getElementById('prod-price').value;
Â  Â  Â  Â  Â  Â  if(!name || !price) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  push(ref(db, `children/${productTargetId}/products`), { name, price: parseFloat(price) })
Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
Â  Â  Â  Â  Â  Â  Â  Â  closeProductModal();Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Chat Logic ---
Â  Â  Â  Â  window.openAdminChat = (id, name) => {
Â  Â  Â  Â  Â  Â  activeChatId = id;
Â  Â  Â  Â  Â  Â  document.getElementById('chat-modal-title').innerText = name;
Â  Â  Â  Â  Â  Â  document.getElementById('admin-chat-modal').style.display = 'flex';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const msgsRef = ref(db, `children/${id}/messages`);
Â  Â  Â  Â  Â  Â  onValue(msgsRef, (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const msgs = snap.val();
Â  Â  Â  Â  Â  Â  Â  Â  renderChat(msgs, 'admin-chat-history', 'admin');
Â  Â  Â  Â  Â  Â  Â  Â  if(msgs) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.keys(msgs).forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(msgs[key].sender === 'parent' && !msgs[key].read) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  update(ref(db, `children/${id}/messages/${key}`), { read: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };
Â  Â  Â  Â  window.closeAdminChat = () => {
Â  Â  Â  Â  Â  Â  activeChatId = null;
Â  Â  Â  Â  Â  Â  document.getElementById('admin-chat-modal').style.display = 'none';
Â  Â  Â  Â  };
Â  Â  Â  Â  window.sendAdminMessage = () => {
Â  Â  Â  Â  Â  Â  const txt = document.getElementById('admin-chat-input').value;
Â  Â  Â  Â  Â  Â  if(!txt) return;
Â  Â  Â  Â  Â  Â  push(ref(db, `children/${activeChatId}/messages`), {
Â  Â  Â  Â  Â  Â  Â  Â  text: txt, sender: 'admin', timestamp: Date.now(), read: false, reaction: ''
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('admin-chat-input').value = '';
Â  Â  Â  Â  };

Â  Â  Â  Â  function initParent(id) {
Â  Â  Â  Â  Â  Â  onValue(ref(db, `children/${id}`), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = snap.val();
Â  Â  Â  Â  Â  Â  Â  Â  if(!data) return;

Â  Â  Â  Â  Â  Â  Â  Â  if(data.status === 'out') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('parent-view').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('session-ended-view').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('final-cost-display').innerText = data.totalCost;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('p-child-name').innerText = data.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('p-child-id').innerText = '#' + data.childId;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Update Status Badge and Logic
Â  Â  Â  Â  Â  Â  Â  Â  const statusBadge = document.getElementById('p-status-badge');
Â  Â  Â  Â  Â  Â  Â  Â  const timerCircle = document.getElementById('live-timer');

Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'paused') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge.innerText = "Ù…ØªÙˆÙ‚Ù Ù…Ø¤Ù‚ØªØ§Ù‹";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge.style.background = "var(--warning)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- REQ: Specific message when paused ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timerCircle.classList.add('paused-circle');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timerCircle.innerHTML = "ØªÙ… Ø§ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆÙ‚Øª<br>Ù„Ø­ÙŠÙ† Ø¹ÙˆØ¯Ø© Ø§Ù„Ø·ÙÙ„";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge.innerText = "Ù…ØªÙˆØ§Ø¬Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusBadge.style.background = "var(--success)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timerCircle.classList.remove('paused-circle');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const prods = data.products ? Object.values(data.products) : [];
Â  Â  Â  Â  Â  Â  Â  Â  let pTotal = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let pHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  prods.forEach(p => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pTotal += p.price;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(p.price > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pHtml += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:5px 0;"><span>${p.name}</span><span>${p.price} Ø¬.Ù…</span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pHtml += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:5px 0; color:var(--success);"><span>${p.name}</span><span>Ù…Ø¬Ø§Ù†Ø§Ù‹</span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(pHtml) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('p-products-list').innerHTML = `<div style="font-weight:bold; margin-bottom:5px;">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</div>` + pHtml;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('p-products-list').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('p-products-list').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  let timeMs = 0;
Â  Â  Â  Â  Â  Â  Â  Â  if(data.status === 'in') timeMs = Date.now() - data.entryTime - (data.totalPausedTime||0);
Â  Â  Â  Â  Â  Â  Â  Â  else timeMs = data.pauseStartTime - data.entryTime - (data.totalPausedTime||0);

Â  Â  Â  Â  Â  Â  Â  Â  const hours = Math.ceil(timeMs / 3600000);
Â  Â  Â  Â  Â  Â  Â  Â  const timeCost = hours * 50;
Â  Â  Â  Â  Â  Â  Â  Â  const totalCost = timeCost + pTotal;

Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'in') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('live-timer').innerText = formatTime(timeMs);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('live-cost').innerText = totalCost;

Â  Â  Â  Â  Â  Â  Â  Â  if(data.status === 'in') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!parentTimer) parentTimer = setInterval(() => initParent(id), 1000);Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(parentTimer) clearInterval(parentTimer);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parentTimer = null; // Clear timer reference to allow restart
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  renderChat(data.messages, 'parent-chat-messages', 'parent');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(data.messages) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let needsUpdate = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updates = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.keys(data.messages).forEach(k => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(data.messages[k].sender === 'admin' && !data.messages[k].read) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updates[`children/${id}/messages/${k}/read`] = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  needsUpdate = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(needsUpdate) update(ref(db), updates);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  window.sendParentMessage = () => {
Â  Â  Â  Â  Â  Â  Â  Â  const txt = document.getElementById('parent-message-input').value;
Â  Â  Â  Â  Â  Â  Â  Â  if(!txt) return;
Â  Â  Â  Â  Â  Â  Â  Â  push(ref(db, `children/${id}/messages`), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: txt, sender: 'parent', timestamp: Date.now(), read: false, reaction: ''
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('parent-message-input').value = '';
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  window.toggleReaction = (msgId) => {
Â  Â  Â  Â  Â  Â  Â  Â get(ref(db, `children/${id}/messages/${msgId}/reaction`)).then(s => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const curr = s.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â update(ref(db, `children/${id}/messages/${msgId}`), { reaction: curr ? '' : 'â¤ï¸' });
Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderChat(msgsObj, containerId, viewer) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById(containerId);
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  if(!msgsObj) return;

Â  Â  Â  Â  Â  Â  const msgs = Object.entries(msgsObj).sort((a,b) => a[1].timestamp - b[1].timestamp);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  msgs.forEach(([key, msg]) => {
Â  Â  Â  Â  Â  Â  Â  Â  const isMe = (viewer === 'admin' && msg.sender === 'admin') || (viewer === 'parent' && msg.sender === 'parent');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = `message ${isMe ? 'sent' : 'recv'}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  div.addEventListener('dblclick', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let pathId = viewer === 'admin' ? activeChatId : urlParams.get('id');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  get(ref(db, `children/${pathId}/messages/${key}/reaction`)).then(s => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const r = s.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  update(ref(db, `children/${pathId}/messages/${key}`), { reaction: r ? '' : 'â¤ï¸' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const time = new Date(msg.timestamp).toLocaleTimeString('en-US', {hour:'numeric', minute:'2-digit'});
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let ticks = '';
Â  Â  Â  Â  Â  Â  Â  Â  if(isMe) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const colorClass = msg.read ? 'tick-read' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const icon = msg.read ? 'fa-check-double' : 'fa-check';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks = `<i class="fas ${icon} tick-icon ${colorClass}"></i>`;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const reactionHtml = msg.reaction ? `<div class="reaction-badge">${msg.reaction}</div>` : '';

Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="msg-content">${msg.text}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="msg-meta">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${time}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${ticks}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${reactionHtml}
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  container.scrollTop = container.scrollHeight;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Action Buttons ---
Â  Â  Â  Â  window.openWhatsApp = (phone, id, link) => {
Â  Â  Â  Â  Â  Â  const finalLink = link || `${window.location.origin}${window.location.pathname}?mode=parent&id=${id}`;
Â  Â  Â  Â  Â  Â  // --- VALIDATION 2: Add '2' before '01' ---
Â  Â  Â  Â  Â  Â  let formattedPhone = phone.replace(/[^0-9]/g,'');
Â  Â  Â  Â  Â  Â  if(formattedPhone.startsWith('01')) {
Â  Â  Â  Â  Â  Â  Â  Â  formattedPhone = '2' + formattedPhone;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const url = `https://wa.me/${formattedPhone}?text=${encodeURIComponent("Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø±Ø§Ø¨Ø· Ù…ØªØ§Ø¨Ø¹Ø© Ø·ÙÙ„Ùƒ ÙÙŠ Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ±:\n" + finalLink)}`;
Â  Â  Â  Â  Â  Â  window.open(url, '_blank');
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.pause = (id) => update(ref(db, `children/${id}`), { status:'paused', pauseStartTime: Date.now() });
Â  Â  Â  Â  window.resume = (id) => {
Â  Â  Â  Â  Â  Â  get(ref(db, `children/${id}`)).then(s => {
Â  Â  Â  Â  Â  Â  Â  Â  const d = s.val();
Â  Â  Â  Â  Â  Â  Â  Â  const pTime = Date.now() - d.pauseStartTime;
Â  Â  Â  Â  Â  Â  Â  Â  update(ref(db, `children/${id}`), { status:'in', totalPausedTime: (d.totalPausedTime||0) + pTime });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- CHECKOUT LOGIC ---
Â  Â  Â  Â  window.checkout = (id) => {
Â  Â  Â  Â  Â  Â  currentChildId = id;
Â  Â  Â  Â  Â  Â  get(ref(db, `children/${id}`)).then(s => {
Â  Â  Â  Â  Â  Â  Â  Â  const d = s.val();
Â  Â  Â  Â  Â  Â  Â  Â  currentBillPhone = d.phone;

Â  Â  Â  Â  Â  Â  Â  Â  let timeMs = d.status === 'in' ? Date.now() - d.entryTime - (d.totalPausedTime||0) : d.pauseStartTime - d.entryTime - (d.totalPausedTime||0);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const hours = Math.ceil(timeMs/3600000);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const timeCost = hours * 50;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const prods = d.products ? Object.values(d.products) : [];
Â  Â  Â  Â  Â  Â  Â  Â  let pTotal = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let productsHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  let waProductsText = "";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  prods.forEach(p => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pTotal += p.price;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const priceTxt = p.price > 0 ? `${p.price} Ø¬.Ù…` : 'Ù…Ø¬Ø§Ù†Ø§Ù‹';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  productsHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="receipt-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${p.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${priceTxt}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waProductsText += `â–«ï¸ ${p.name}: ${priceTxt}%0a`;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if(productsHTML === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  productsHTML = '<div style="text-align:center; color:#ccc; font-size:0.8rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waProductsText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©%0a";
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const totalAmount = timeCost + pTotal;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
Â  Â  Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  const dayName = days[now.getDay()];
Â  Â  Â  Â  Â  Â  Â  Â  const dateStr = now.toLocaleDateString('ar-EG');
Â  Â  Â  Â  Â  Â  Â  Â  const fullDate = `${dayName}ØŒ ${dateStr}`;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bill-child-name').innerText = d.name;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bill-duration').innerText = `${hours} Ø³Ø§Ø¹Ø© (${timeCost} Ø¬.Ù…)`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bill-date-line').innerText = fullDate;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bill-products-container').innerHTML = productsHTML;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bill-total-amount').innerText = totalAmount + ' Ø¬.Ù…';

Â  Â  Â  Â  Â  Â  Â  Â  const waMessage = `*ÙØ§ØªÙˆØ±Ø© Ù…Ù†Ø·Ù‚Ø© Ø£Ù„Ø¹Ø§Ø¨ Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ±* ğŸª%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Ù„Ù‚Ø¯ Ø§Ø³ØªÙ…ØªØ¹ Ø·ÙÙ„ÙƒÙ… *${d.name}* Ø¨Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ù†Ø§ ğŸ˜%0a%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `â³ *Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:* ${hours} Ø³Ø§Ø¹Ø§Øª%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `ğŸ’° *Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª:* ${timeCost} Ø¬.Ù…%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `ğŸ“‹ *Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:*%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waProductsText +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `ğŸ’µ *Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* *${totalAmount} Ø¬.Ù…*%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `ğŸ“… *Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${fullDate}%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `--------------------------------%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… Ù…Ù†Ø·Ù‚Ø© Ø£Ù„Ø¹Ø§Ø¨ Ø£ÙˆØ¨Ø±Ø§ Ø¹Ø§Ø´ÙˆØ± â¤ï¸%0a` +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Ù†Ù†ØªØ¸Ø± Ø¹ÙˆØ¯ØªÙƒÙ… Ù„Ù†Ø§ âœ¨`;

Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('btn-send-bill-wa');
Â  Â  Â  Â  Â  Â  Â  Â  btn.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Ensure 2 + phone
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let p = currentBillPhone.replace(/[^0-9]/g,'');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(p.startsWith('01')) p = '2' + p;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const url = `https://wa.me/${p}?text=${waMessage}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â window.open(url, '_blank');
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Show confirm button for live checkout
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('btn-confirm-checkout').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('checkout-modal').style.display = 'flex';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  window.confirmCheckout = () => {
Â  Â  Â  Â  Â  Â  const total = document.getElementById('bill-total-amount').innerText.replace(' Ø¬.Ù…','');
Â  Â  Â  Â  Â  Â  update(ref(db, `children/${currentChildId}`), { status:'out', exitTime: Date.now(), totalCost: total });
Â  Â  Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  Â  Â  showToast('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬');
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Utils ---
Â  Â  Â  Â  window.closeQR = () => document.getElementById('new-child-qr').classList.add('hidden');
Â  Â  Â  Â  window.closeModal = () => document.getElementById('checkout-modal').style.display = 'none';
Â  Â  Â  Â  function formatTime(ms) {
Â  Â  Â  Â  Â  Â  const s = Math.floor((ms/1000)%60).toString().padStart(2,'0');
Â  Â  Â  Â  Â  Â  const m = Math.floor((ms/60000)%60).toString().padStart(2,'0');
Â  Â  Â  Â  Â  Â  const h = Math.floor(ms/3600000).toString().padStart(2,'0');
Â  Â  Â  Â  Â  Â  return `${h}:${m}:${s}`;
Â  Â  Â  Â  }
Â  Â  Â  Â  function showToast(msg) {
Â  Â  Â  Â  Â  Â  const t = document.createElement('div');
Â  Â  Â  Â  Â  Â  t.style.cssText = "background:#333; color:white; padding:10px 20px; border-radius:5px; margin-top:10px; box-shadow:0 3px 10px rgba(0,0,0,0.2);";
Â  Â  Â  Â  Â  Â  t.innerText = msg;
Â  Â  Â  Â  Â  Â  document.getElementById('toast-container').appendChild(t);
Â  Â  Â  Â  Â  Â  setTimeout(() => t.remove(), 3000);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Clock
Â  Â  Â  Â  setInterval(() => {
Â  Â  Â  Â  Â  Â  document.getElementById('header-datetime').innerText = new Date().toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'});
Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // EXPOSE FUNCTIONS GLOBALLY
Â  Â  Â  Â  window.addProduct = addProduct;
Â  Â  Â  Â  window.openProductModal = openProductModal;
Â  Â  Â  Â  window.deleteProduct = deleteProduct;
Â  Â  Â  Â  window.closeProductModal = closeProductModal;

Â  Â  </script>
</body>
</html>
